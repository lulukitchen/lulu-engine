# Project Structure - @lulu/engine

Comprehensive overview of the Lulu Engine project organization, designed to help developers and AI coding assistants understand the codebase architecture.

## 📁 Root Directory Structure

```
lulu-engine/
├── .github/                 # GitHub-specific files
│   └── workflows/
│       └── ci.yml          # Continuous Integration pipeline
├── src/                    # Source code (TypeScript/React)
│   ├── index.ts           # Main entry point - exports all public APIs
│   ├── types.ts           # Central type definitions
│   ├── components/        # Reusable React components
│   ├── hooks/             # Custom React hooks
│   ├── provider/          # React Context providers
│   ├── services/          # External API integrations
│   └── utils/             # Pure utility functions
├── dist/                   # Built output (generated by `npm run build`)
│   ├── index.js           # ESM bundle
│   ├── index.cjs          # CommonJS bundle
│   ├── index.d.ts         # TypeScript declarations (ESM)
│   └── index.d.cts        # TypeScript declarations (CJS)
├── node_modules/          # Dependencies (ignored in git)
├── .eslintrc.cjs          # ESLint configuration
├── .gitignore             # Git ignore patterns
├── API.md                 # Complete API documentation
├── CONTRIBUTING.md        # Contributor guidelines
├── LICENSE                # MIT License
├── package.json           # Project configuration and dependencies
├── package-lock.json      # Exact dependency versions
├── README.md              # Project overview and quick start
├── TESTING.md             # Testing setup and guidelines
├── tsconfig.json          # TypeScript configuration
└── lulu-engine-starter.zip # Original starter files archive
```

## 🎯 Source Code Organization

### `/src` Directory Detailed Structure

```
src/
├── index.ts                 # 📤 Public API exports
├── types.ts                 # 🏷️  TypeScript definitions
│
├── provider/                # 🔗 React Context Providers
│   └── EngineProvider.tsx   #     Main configuration provider
│
├── hooks/                   # 🎣 Custom React Hooks
│   ├── useCart.ts          #     Shopping cart state management
│   └── useLanguage.tsx     #     Internationalization (i18n)
│
├── services/                # 🌐 External Integrations
│   ├── menuService.ts      #     CSV menu fetching/parsing
│   ├── emailService.ts     #     Order email notifications
│   └── whatsappService.ts  #     WhatsApp message formatting
│
├── utils/                   # 🛠️  Pure Utility Functions
│   ├── businessHours.ts    #     Operating hours logic
│   ├── coupons.ts          #     Discount calculations
│   └── recommendations.ts  #     Product suggestions
│
└── components/              # ⚛️  React UI Components
    ├── MenuItemModal.tsx   #     Product details popup
    ├── PaymentOptions.tsx  #     Payment method selector
    ├── TimePicker.tsx      #     Delivery time picker
    └── WhatsAppButton.tsx  #     WhatsApp contact button
```

## 🏗️ Architecture Layers

### 1. **Export Layer** (`index.ts`)
- Single entry point for all public APIs
- Named exports only (no default exports)
- Clean, documented interface for consumers

### 2. **Type System** (`types.ts`)
- Centralized TypeScript definitions
- Domain models: MenuItem, CartItem, Order, etc.
- Configuration interfaces: EngineConfig, BusinessHours
- Strict typing for all public APIs

### 3. **Provider Layer** (`provider/`)
- React Context for dependency injection
- Configuration management
- Global state initialization

### 4. **Hook Layer** (`hooks/`)
- Stateful logic encapsulation
- React-specific integrations
- localStorage persistence
- Cross-component state sharing

### 5. **Service Layer** (`services/`)
- External system integrations
- Data transformation (CSV parsing, etc.)
- Communication protocols (email, WhatsApp)
- Async operations handling

### 6. **Utility Layer** (`utils/`)
- Pure functions (no side effects)
- Business logic implementations
- Calculations and validations
- Reusable algorithms

### 7. **Component Layer** (`components/`)
- Presentational React components
- Minimal business logic
- Customizable through props
- Accessibility-focused

## 🔄 Data Flow Architecture

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   CSV Source    │───▶│  menuService    │───▶│   MenuItem[]    │
│ (Google Sheets) │    │   (parsing)     │    │     (state)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  User Actions   │───▶│   useCart()     │───▶│  localStorage   │
│  (add/remove)   │    │    (hook)       │    │ (persistence)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│    Order        │───▶│   Services      │───▶│   External      │
│ (processed)     │    │ (email/whatsapp)│    │    Systems      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 📦 Build System Architecture

### Input Sources
- TypeScript source files (`src/**/*.ts`, `src/**/*.tsx`)
- Type definitions (`src/types.ts`)
- Configuration files (`tsconfig.json`, `.eslintrc.cjs`)

### Build Pipeline (tsup)
1. **TypeScript Compilation**: Source → JavaScript
2. **Bundle Generation**: 
   - ESM format (`dist/index.js`)
   - CommonJS format (`dist/index.cjs`)
3. **Type Declaration Generation**:
   - ESM types (`dist/index.d.ts`)
   - CommonJS types (`dist/index.d.cts`)

### Output Targets
- **Modern Browsers**: ES2020 syntax support
- **Node.js**: CommonJS compatibility
- **TypeScript Projects**: Full type information

## 🔧 Development Workflow

### File Creation Patterns

#### Adding a New Hook
```bash
# 1. Create the hook file
touch src/hooks/useNewFeature.ts

# 2. Implement the hook
cat > src/hooks/useNewFeature.ts << 'EOF'
import { useState, useEffect } from 'react';

export function useNewFeature() {
  const [state, setState] = useState();
  
  // Hook implementation
  
  return { state, setState };
}
EOF

# 3. Export from index.ts
echo 'export * from "./hooks/useNewFeature";' >> src/index.ts

# 4. Test the build
npm run build
```

#### Adding a New Component
```bash
# 1. Create component file
touch src/components/NewComponent.tsx

# 2. Implement component
cat > src/components/NewComponent.tsx << 'EOF'
import React from 'react';

export const NewComponent: React.FC<{
  prop: string;
}> = ({ prop }) => {
  return <div>{prop}</div>;
};
EOF

# 3. Export and build
echo 'export * from "./components/NewComponent";' >> src/index.ts
npm run build
```

### Quality Assurance Pipeline

1. **Type Checking**: `npm run type-check`
   - Validates TypeScript types
   - Catches type errors early
   - No runtime impact

2. **Linting**: `npm run lint`
   - Code style consistency
   - React hooks rules
   - Best practices enforcement

3. **Building**: `npm run build`
   - Multi-format bundling
   - Type declaration generation
   - Distribution preparation

4. **CI Pipeline**: GitHub Actions
   - Automated quality checks
   - Build verification
   - Deployment readiness

## 🎨 Code Organization Principles

### 1. **Separation of Concerns**
- **Components**: UI presentation only
- **Hooks**: State management and side effects
- **Services**: External system communication
- **Utils**: Pure business logic

### 2. **Dependency Direction**
```
Components ──▶ Hooks ──▶ Services ──▶ Utils
     │                      │
     └──────▶ Types ◀───────┘
```

### 3. **Import Conventions**
```typescript
// ✅ Good: Specific, named imports
import { useCart, MenuItem } from '@lulu/engine';

// ❌ Bad: Wildcard imports
import * as LuluEngine from '@lulu/engine';
```

### 4. **Export Patterns**
```typescript
// ✅ Good: Named exports
export function calculateTotal(items: CartItem[]): number { ... }
export const PaymentButton: React.FC<Props> = ({ ... }) => { ... };

// ❌ Bad: Default exports
export default function calculateTotal(items: CartItem[]): number { ... }
```

## 🔍 File Naming Conventions

### TypeScript Files
- **Hooks**: `use[FeatureName].ts` (e.g., `useCart.ts`)
- **Services**: `[domain]Service.ts` (e.g., `menuService.ts`)
- **Utils**: `[domain].ts` (e.g., `businessHours.ts`)
- **Types**: `types.ts` (central) or `[domain].types.ts`

### React Components
- **Component Files**: `[ComponentName].tsx` (PascalCase)
- **Export Name**: Same as filename (e.g., `PaymentOptions.tsx` → `PaymentOptions`)

### Configuration Files
- **ESLint**: `.eslintrc.cjs` (CommonJS for compatibility)
- **TypeScript**: `tsconfig.json` (JSON format)
- **Git**: `.gitignore` (dot prefix)

## 📚 Documentation Structure

### Primary Documentation
1. **README.md**: Project overview, quick start, basic examples
2. **API.md**: Complete API reference with types and examples
3. **CONTRIBUTING.md**: Development setup and contribution guidelines
4. **TESTING.md**: Test strategy and setup instructions

### Code Documentation
- **JSDoc Comments**: For complex functions and classes
- **Inline Comments**: For non-obvious business logic
- **Type Annotations**: Explicit types for all public APIs
- **README Sections**: Usage examples and integration guides

This structure ensures the codebase remains maintainable, discoverable, and easy to extend for both human developers and AI coding assistants.